<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>CodeMash HTML5 PreCompiler WebSockets Lab</title>
        <meta name="author" content="Clark Sell, Brandon Satrom" />
        
        <script type="text/javascript" src="http://localhost:8080/scripts/socket.io.js "></script>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
        <script type="text/javascript" src="scripts/ext-all-debug.js "></script>

    </head>
    <body>
        <section>
            <p>
       		<label for="messageText">Message Text</label>
                <input type="text" id="sendMessage"/>
            </p>
            <p>	
	            <button id="submit">Add cheat</button>
            </p>
        </section>
        
        <section>
        	<ul id="systemMessages"></ul>
        </section>
        
    	<section>
    		<hr/>	
            <div id="cheats"></div>
        </section>
        
        <script type="text/javascript">
            $(document).ready(function() {

		var cheatStore = Ext.create('Ext.data.Store', {
			fields: ['cheat','vote'],
			data: {'cheats': [{'cheat': 'alert("hi");', 'vote': 1},{'cheat': '[]+[]', 'vote': 2}]},
			proxy: {
				type:'memory',
				reader: {
					type: 'json',
					root: 'cheats'
				}
			}
		}); 

		var grid = Ext.create('Ext.grid.Panel', {
			title: 'Cheat Sheet',
			store: cheatStore, 
			columns: [{header: 'Cheat', dataIndex: 'cheat'}, {header: 'Vote', dataIndex: 'vote'}],
			renderTo: 'cheats'

		}); 


            	var webSocket = new io.connect('http://localhost:8080');
                
                webSocket.on('connect', function() {
                    $('#systemMessages').append('<li>Connected to the server.</li>');
                });

		webSocket.on('disconnect', function() {
                    $('#systemMessages').append('<li>Disconnected from the server.</li>');
                });
                
                webSocket.on('message', function(message) {
                	cheatStore.loadRawData({'cheats':message}, false);
		});
                
		$('#submit').bind('click', function() {
			var message = {id: 0, 'cheat': $('#sendMessage').val(), 'vote': 0};
			webSocket.emit('message', message);
		});

            });
        </script>
    </body>
</html>
